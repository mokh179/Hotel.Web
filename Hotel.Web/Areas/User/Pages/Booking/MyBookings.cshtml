@page
@model Hotel.Web.Areas.User.Pages.Booking.MyBookingsModel
<link rel="stylesheet" href="~/css/User/mybookings.css" asp-append-version="true" />

<h2 class="title">My Bookings</h2>

@if (Model.Bookings == null || Model.Bookings.Count == 0)
{
        <p>You have no bookings yet.</p>
}
else
{
        <div class="booking-list">
        @foreach (var b in Model.Bookings)
        {
                    <div class="booking-card">
                        <div class="info">
                            <h3 class="hotel">@b.HotelName</h3>
                            <p class="room"><b>Room:</b> @b.RoomName</p>
                            <p><b>Check-in:</b> @b.DateRange.From.ToShortDateString()</p>
                            <p><b>Check-out:</b> @b.DateRange.To.ToShortDateString()</p>

                    @if (b.DateRange.From < DateTime.UtcNow)
                    {
                                    <span class="past-status">Completed</span>
                    }
                    else
                    {
                                    <span class="active-status">Active</span>
                    }
                        </div>

                        <button class="details-btn"
                                type="button"
                                onclick="loadBookingDetails('@b.Id')">
                            Details
                        </button>

                @if (b.DateRange.From >= DateTime.UtcNow)
                {
                                <form method="post" asp-page-handler="Cancel" asp-route-id="@b.Id">
                                    <button class="cancel-btn">Cancel Booking</button>
                                </form>
                }
                    </div>
        }
        </div>
}

<!-- 🔹 Modal should always exist -->
<div class="modal fade" id="bookingDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" id="booking-details-container">
        </div>
    </div>
</div>

@section Scripts {
        <script>
            function loadBookingDetails(id) {
                fetch(`/User/Booking/MyBookings?handler=Details&id=${id}`)
                    .then(res => res.text())
                    .then(html => {
                        document.getElementById("booking-details-container").innerHTML = html;
                        var modal = new bootstrap.Modal(document.getElementById('bookingDetailsModal'));
                        modal.show();
                    });
            }
        </script>
}
